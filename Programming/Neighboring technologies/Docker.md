> [!info] Основная идея  
> Docker — это инструмент контейнеризации, который позволяет запускать приложения изолированно, быстро и предсказуемо. 

---

## Краткий конспект

- Docker — это клиент-серверная система: CLI, Engine и Registry.
- Контейнер ≠ виртуалка: он использует ядро хоста, быстрее и легче.
- Dockerfile описывает шаги сборки образа: `FROM`, `COPY`, `CMD`, `RUN` и др.
- `docker-compose.yaml` — удобный способ описать многосервисную систему.
- Частые темы интервью: слои, overlay2, сети, разница `CMD`/`ENTRYPOINT`.
- Контейнеры работают через namespace/cgroup и используют Copy-on-Write.
- Ошибки кандидатов — root внутри контейнера, неумение кэшировать слои.

---

## Что такое Docker?

Docker — это **платформа для упаковки, доставки и запуска приложений** в контейнерах. Она состоит из трёх компонентов:

- **Docker Engine** — демон, управляющий образами и контейнерами.
- **Docker CLI** — командная утилита (`docker build`, `run`, `exec`, …).
- **Docker Registry** — хранилище образов, например Docker Hub.

Контейнеры изолированы, но используют общее ядро хоста, в отличие от виртуальных машин.

> [!tip]
> Типовой вопрос интервью: *«Что такое контейнер в Docker?»*  
> **Правильный ответ:** Изолированный процесс, запущенный с собственными файловой системой, сетевыми и ресурсными ограничениями, но использующий ядро хоста.

---

## Docker vs виртуальные машины

| Параметр             | Контейнер (Docker)        | Виртуальная машина (VM)    |
| -------------------- | ------------------------- | -------------------------- |
| Использование ядра   | Использует **ядро хоста** | Эмулирует собственное ядро |
| Оверхед              | Минимальный               | Значительный               |
| Время запуска        | Почти мгновенное          | Секунды                    |
| Размер образа        | Сотни МБ                  | ГБ и выше                  |
| Изоляция             | Пространство имён, cgroup | Полная через гипервизор    |


> [!tip]
> На интервью часто спрашивают: *«Почему контейнеры быстрее?»*  
> **Ответ:** Потому что не требуют запуска полноценной ОС и используют ядро хоста напрямую.

---

## Как работает Docker

Docker использует **образы** как шаблоны, из которых запускаются **контейнеры**. Образ состоит из **слоёв (layers)**. Контейнер — это исполняемый слой + метаданные.

Контейнер запускается в изоляции с помощью:

- **namespaces** — изолируют PID, сеть, файловую систему и т. д.
- **cgroups** — ограничивают ресурсы (CPU, память и пр.).

> [!example]
> Типовой вопрос интервью: *«Зачем нужны cgroups?»*  
> **Ответ:** Чтобы ограничивать использование ресурсов контейнером.

---

## Dockerfile: правила и best practices

Dockerfile — это скрипт сборки образа. Он читается сверху вниз и кэшируется построчно.

### Основные инструкции:

```dockerfile
FROM golang:1.21 AS builder
WORKDIR /app
COPY . .
RUN go build -o main

FROM alpine:latest
WORKDIR /root/
COPY --from=builder /app/main .
ENTRYPOINT ["./main"]
```

### Часто используемые команды:

- `FROM` — базовый образ.
- `RUN` — выполнение команд.
- `COPY` / `ADD` — копирование файлов.
- `CMD` / `ENTRYPOINT` — стартовая команда.
- `EXPOSE` — документация порта.

> [!tip]
> `ENTRYPOINT` предпочтительнее, если процесс нельзя переопределить флагами.

---

### Типичные ловушки на собеседовании

> [!example]
> **Q:** Что такое multi-stage build?  
> **A:** Это приём, когда один Dockerfile использует несколько `FROM`, чтобы разделить сборку и финальный образ.
>
> **Q:** Зачем нужен `.dockerignore`?  
> **A:** Чтобы не копировать лишние файлы в образ, ускорить сборку и уменьшить размер.
>
> **Q:** Почему `CGO_ENABLED=0` часто ставят при сборке Go-приложений?  
> **A:** Чтобы отключить зависимости от libc и получить статически слинкованное бинарное приложение, пригодное для scratch или alpine.

---

## Docker Compose: зачем нужен и как писать

Compose — это инструмент для описания **мультисервисной среды** (например, API + база данных).

```yaml
version: "3.8"
services:
  app:
    build: .
    ports:
      - "8080:8080"
    env_file:
      - .env

  db:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: secret
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:
```

### Ключевые понятия:

- `services` — контейнеры.
- `volumes` — хранилище данных между перезапусками.
- `env_file` — удобный способ задавать переменные окружения.
- `depends_on` — задаёт порядок запуска.

> [!example]
> **Q:** Чем `depends_on` отличается от `links`?  
> **A:** `depends_on` управляет порядком запуска, `links` устарел и даёт сетевой alias.

---

## Частые вопросы на собеседовании

> [!faq]  
> **Q:** В чём разница `CMD` и `ENTRYPOINT`?  
> **A:** `CMD` переопределяется аргументами при запуске, `ENTRYPOINT` — нет.  
>  
> **Q:** Как уменьшить размер образа?  
> **A:** Использовать `alpine` или `scratch`, убирать кеши, чистить `apt`.  
>  
> **Q:** Как передать переменные окружения в контейнер?  
> **A:** Через флаг `-e`, файл `.env` или `env_file` в Compose.  
>  
> **Q:** Что делает `--no-cache` при сборке?  
> **A:** Отключает использование кэша Docker, заставляя выполнить все шаги заново.  
>  
> **Q:** Для чего нужен `--platform`?  
> **A:** Позволяет указать целевую архитектуру (`linux/amd64`, `linux/arm64`).
  
---

> [!warning]
> **Нюансы и подводные камни:**
> - **Сетевой режим host** — может нарушать изоляцию (в контейнере тот же netstack, что у хоста).
> - **Пользователь root внутри контейнера** — может быть опасен на проде.
> - **Кросс-платформенные сборки** — требуют указания `--platform` и правильной сборки бинарников.
> - **Большие образы** — влияют на скорость CI/CD и деплой.

---

## FAQ

> [!faq]  
> **Q:** Чем `docker exec` отличается от `docker run`?  
> **A:** `exec` запускает команду в уже работающем контейнере, `run` создаёт и запускает новый.  
>
> **Q:** Можно ли монтировать локальную папку в контейнер?  
> **A:** Да, через `-v $(pwd):/app`.  
>
> **Q:** Что делает `docker system prune`?  
> **A:** Удаляет неиспользуемые образы, контейнеры и тома.  
>
> **Q:** Чем `bind mount` отличается от `volume`?  
> **A:** `volume` управляется Docker, `bind mount` указывает на конкретную папку хоста.  
>
> **Q:** Как понять, какие образы занимают больше всего места?  
> **A:** `docker images --format '{{.Size}}\t{{.Repository}}:{{.Tag}}' | sort -hr`

---

## Полезные ссылки

- [What is Docker? (официальная документация)](https://docs.docker.com/get-started/docker-overview/?utm_source=chatgpt.com)  
- [Dockerfile Reference](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com)  
- [Best Practices for Dockerfiles](https://docs.docker.com/build/building/best-practices/?utm_source=chatgpt.com)  
- [Compose file reference](https://docs.docker.com/compose/compose-file/?utm_source=chatgpt.com)  
- [[Docker команды]]
