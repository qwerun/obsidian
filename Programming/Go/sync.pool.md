# sync.Pool –≤ Go: –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

> [!info]
> `sync.Pool` ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑ –ø–∞–∫–µ—Ç–∞ sync, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤. –û–Ω–∞ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ garbage collector –∏ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–∏—Ç—É–∞—Ü–∏—è—Ö —Å –±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤. `sync.Pool` –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω —Ç–∞–º, –≥–¥–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–µ–µ, –Ω–æ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.

---

## –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏.
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** —Å–Ω–∏–∂–µ–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π, —É–º–µ–Ω—å—à–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞.
- **–¢–∏–ø–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** –±—É—Ñ–µ—Ä—ã, –±–∞–π—Ç–æ–≤—ã–µ —Å–ª–∞–π—Å—ã, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- **–°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:** [[garbage collector]], –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, object reuse, preallocation.

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ `sync.Pool`?

`sync.Pool` ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç-–ø—É–ª, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏. –û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π API:

```go
type Pool struct {
    New func() any
}
````

–ú–µ—Ç–æ–¥—ã:

- `Get()` ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –ø—É–ª–∞ –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π, –µ—Å–ª–∏ –ø—É–ª –ø—É—Å—Ç.
    
- `Put(x any)` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—É–ª.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```go
var bufPool = sync.Pool{
    New: func() any {
        return make([]byte, 0, 4096)
    },
}

buf := bufPool.Get().([]byte)
// ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—É—Ñ–µ—Ä ...
buf = buf[:0] // –æ—á–∏—Å—Ç–∏—Ç—å
bufPool.Put(buf)
```

---

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `sync.Pool` –≤–Ω—É—Ç—Ä–∏ —Ä–∞–Ω—Ç–∞–π–º–∞ Go?

–í–Ω—É—Ç—Ä–∏ `sync.Pool` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–µ—á–Ω—ã–π –∫—ç—à —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏:

- –ö–∞–∂–¥—ã–π P (`GOMAXPROCS`) –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤.
    
- –ú–µ–∂–¥—É P –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ ‚Äî —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—é.
    
- –í –º–æ–º–µ–Ω—Ç `GC`, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `sync.Pool` **–æ—á–∏—â–∞–µ—Ç—Å—è**, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —É–¥–µ—Ä–∂–∞–Ω–∏–µ –º—É—Å–æ—Ä–∞.
    
- –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –ø—É—Å—Ç—ã, `sync.Pool` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π fallback.
    

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç `sync.Pool` —Ö–æ—Ä–æ—à–∏–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–º –¥–ª—è **–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤**, –Ω–æ –Ω–µ –¥–ª—è –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

---

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

#### **–ü–ª—é—Å—ã**

- üìâ **–°–Ω–∏–∂–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è –Ω–∞ GC**  
    –û–±—ä–µ–∫—Ç—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —É–º–µ–Ω—å—à–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ª–ª–æ–∫–∞—Ü–∏–π –∏ –ø–∞—É–∑ GC.
    
- ‚ö° **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**  
    –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É P ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É–ª—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã.
    
- üß± **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**  
    –ú–∏–Ω–∏–º—É–º API: `Get()` –∏ `Put()`.

#### **–ú–∏–Ω—É—Å—ã**

- ‚ùó **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏**  
    –û–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞.
    
- üîÑ **Put ‚Üí Get –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–≥–æ –∂–µ –æ–±—ä–µ–∫—Ç–∞**  
    –≠—Ç–æ **–ø—É–ª, –∞ –Ω–µ –∫–µ—à** ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Å–ª–∞–±–µ–µ.
    
- üíÄ **–ù–µ–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤**  
    –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    
- üß™ **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ –æ–±–Ω—É–ª–µ–Ω–∏—è**  
    –ü–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≤ –ø—É–ª –æ–±—ä–µ–∫—Ç –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å, –∏–Ω–∞—á–µ –≤–æ–∑–º–æ–∂–Ω—ã —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

---

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

#### –ü—Ä–∏–º–µ—Ä 1: –±—É—Ñ–µ—Ä—ã –≤ HTTP-—Å–µ—Ä–≤–µ—Ä–µ

–í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ `net/http` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sync.Pool` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±—É—Ñ–µ—Ä–æ–≤ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:

```go
var bufPool = sync.Pool{
    New: func() any {
        return new(bytes.Buffer)
    },
}

func handler(w http.ResponseWriter, r *http.Request) {
    buf := bufPool.Get().(*bytes.Buffer)
    buf.Reset()
    defer bufPool.Put(buf)

    // ... –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å buf ...
}
```

> [!tip]  
> `bytes.Buffer` ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–ª—è –ø—É–ª–∞, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ HTML, JSON –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏.

#### –ü—Ä–∏–º–µ—Ä 2: –¥–µ—à—ë–≤—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫ –¥–ª—è –ª–æ–≥–≥–µ—Ä–∞

```go
type logLine struct {
    ts   time.Time
    msg  string
    tags map[string]string
}

var linePool = sync.Pool{
    New: func() any {
        return new(logLine)
    },
}

func acquireLogLine() *logLine {
    return linePool.Get().(*logLine)
}

func releaseLogLine(l *logLine) {
    l.msg = ""
    l.tags = nil
    linePool.Put(l)
}
```

---

> [!warning]  
> **–ù—é–∞–Ω—Å—ã –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**
> 
> - `sync.Pool` –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª—ë–Ω –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç GC.
>     
> - –û–±—ä–µ–∫—Ç—ã –Ω—É–∂–Ω–æ **–æ—á–∏—â–∞—Ç—å –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º** ‚Äî `Put()` –Ω–µ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
>     
> - –ù–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ `sync.Pool` –∫–∞–∫ –Ω–∞ –∫–µ—à ‚Äî –æ–Ω –º–æ–∂–µ—Ç ¬´–∑–∞–±—ã—Ç—å¬ª –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º GC.
>     
> - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—É–ª–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ Go: –Ω–∞—á–∏–Ω–∞—è —Å **Go 1.13** –≤ —Ä–∞–Ω—Ç–∞–π–º–µ —É–ª—É—á—à–µ–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ P.
>     

---

> [!tip]  
> **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**
> 
> - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sync.Pool` —Ç–æ–ª—å–∫–æ –¥–ª—è **–∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏—Ö, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö** –æ–±—ä–µ–∫—Ç–æ–≤.
>     
> - –û–±—ä–µ–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã** (–±–µ–∑ shared state), –∏–Ω–∞—á–µ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å race.
>     
> - –í—Å–µ–≥–¥–∞ **–æ–±–Ω—É–ª—è–π—Ç–µ** –ø–æ–ª—è, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ –æ–±—ä–µ–∫—Ç—ã.
>     
> - –ò–∑–º–µ—Ä—è–π—Ç–µ: –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—É–ª–∞ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ **—Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ** –∏ –¥–æ–∫–∞–∑–∞–Ω–Ω–æ–º –≤—ã–∏–≥—Ä—ã—à–µ.
>     

---

> [!faq]  
> **Q:** –£–¥–∞–ª—è–µ—Ç –ª–∏ GC –æ–±—ä–µ–∫—Ç—ã –∏–∑ `sync.Pool`?  
> **A:** –î–∞. –ü—É–ª –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–±–æ—Ä–µ –º—É—Å–æ—Ä–∞.
> 
> **Q:** –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ `Get()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ `Pool` –ø—É—Å—Ç?  
> **A:** –ë—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `New`, –µ—Å–ª–∏ –æ–Ω–∞ –∑–∞–¥–∞–Ω–∞. –ò–Ω–∞—á–µ –≤–µ—Ä–Ω—ë—Ç—Å—è `nil`.
> 
> **Q:** –ú–æ–∂–Ω–æ –ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –∏–ª–∏ —Å–æ–∫–µ—Ç—ã –≤ `sync.Pool`?  
> **A:** –ù–µ—Ç, —ç—Ç–æ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ connection-pool –∏–ª–∏ `sync.Once`.
> 
> **Q:** –ü–æ—á–µ–º—É –∏–Ω–æ–≥–¥–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å `sync.Pool` –Ω–∏–∑–∫–∞—è?  
> **A:** –ü—Ä–∏—á–∏–Ω—ã: —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ–±—ä–µ–∫—Ç–æ–≤, —á–∞—Å—Ç—ã–µ GC, –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è.

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [https://pkg.go.dev/sync?utm_source=chatgpt.com](https://pkg.go.dev/sync?utm_source=chatgpt.com)
    
- [https://www.codingexplorations.com/blog/creating-efficient-go-applications-with-syncpool?utm_source=chatgpt.com](https://www.codingexplorations.com/blog/creating-efficient-go-applications-with-syncpool?utm_source=chatgpt.com)
    
- [https://victoriametrics.com/blog/go-sync-pool/?utm_source=chatgpt.com](https://victoriametrics.com/blog/go-sync-pool/?utm_source=chatgpt.com)
    
- [https://wundergraph.com/blog/golang-sync-pool?utm_source=chatgpt.com](https://wundergraph.com/blog/golang-sync-pool?utm_source=chatgpt.com)
    
- [https://tip.golang.org/wiki/Performance?utm_source=chatgpt.com](https://tip.golang.org/wiki/Performance?utm_source=chatgpt.com)
    
- [https://tip.golang.org/blog/go119runtime?utm_source=chatgpt.com](https://tip.golang.org/blog/go119runtime?utm_source=chatgpt.com)
