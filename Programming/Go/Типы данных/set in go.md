> [!info] Основная идея  
> В языке Go нет встроенного типа `set`, но его легко реализовать с помощью `map` — отображения, где ключи представляют элементы множества, а значения чаще всего не используются.

---

## Краткий конспект

- В Go **множество (set)** обычно реализуют через **`map[K]struct{}`** или **`map[K]bool`**.
- Структура **`map[K]struct{}`** минимальна по памяти, так как `struct{}` занимает 0 байт.
- Добавление элемента — это простое **присваивание ключа** в мапу.
- Проверка наличия — через **`_, ok := m[k]`**.
- Для **дженериковых сетов** используется `type Set[T comparable] map[T]struct{}`.
- При параллельной работе используют **`sync.Map`** или **мьютекс + map**.

---

## Подробно

### Что такое `map` и почему её используют как set

В Go нет типа `set`, но есть универсальная хэш-таблица `map[K]V`. Если значение (`V`) нам не важно — можно использовать либо `bool`, либо `struct{}`.

```go
m := make(map[string]struct{})
m["apple"] = struct{}{}
````

Это означает: «в сете есть строка `"apple"`».

[[map||Map (Go)]] — встроенный тип отображения, используется для создания множества за счёт уникальности ключей.

---

### Варианты реализации

#### `map[K]struct{}`

```go
set := map[string]struct{}{
	"one": {},
	"two": {},
}
```

- Эффективно по памяти.
    
- Часто используется в performance-критичных местах.
    

#### `map[K]bool`

```go
set := map[string]bool{
	"one": true,
	"two": true,
}
```

- Удобно, если нужно хранить признак (`true/false`).
    
- Занимает немного больше памяти (1 байт против 0).
    

---

### Операции с множеством

#### Добавление элемента

```go
set["item"] = struct{}{}
```

#### Удаление

```go
delete(set, "item")
```

#### Проверка наличия

```go
_, ok := set["item"]
```

#### Размер множества

```go
size := len(set)
```

#### Перебор элементов

```go
for k := range set {
	fmt.Println(k)
}
```

---

### Сравнение с `slice`

|Операция|`map` / set|`slice`|
|---|---|---|
|Добавление|O(1)|O(1) (с апендом)|
|Поиск элемента|O(1)|O(n)|
|Удаление|O(1)|O(n)|
|Уникальность|Гарантирована|Требует дополнительной логики|

> [!tip]  
> Используйте `set` на `map`, если важно обеспечить **уникальность** и **быстрый доступ**.

---

### Конкурентный доступ

#### `sync.Map`

```go
var s sync.Map
s.Store("a", struct{}{})
_, ok := s.Load("a")
```

#### Через `sync.Mutex`:

```go
type SafeSet struct {
	mu  sync.Mutex
	set map[string]struct{}
}

func (s *SafeSet) Add(v string) {
	s.mu.Lock()
	defer s.mu.Unlock()
	s.set[v] = struct{}{}
}
```

---

> [!example]  
> **Пример использования множества**

```go
package main

import (
	"fmt"
)

func main() {
	set := make(map[string]struct{})

	// Добавление
	set["apple"] = struct{}{}
	set["banana"] = struct{}{}

	// Проверка
	if _, ok := set["banana"]; ok {
		fmt.Println("Есть банан")
	}

	// Удаление
	delete(set, "apple")

	// Перебор
	for fruit := range set {
		fmt.Println("В сете:", fruit)
	}
}
```

---

> [!warning]  
> **Типичные ошибки:**
> 
> - Попытка читать из `nil`-мапы (приведёт к `panic` при записи).
>     
> - Повторное добавление ключа без проверки (в Go это не ошибка, но может быть логическая ошибка).
>     
> - Использование `map` в конкурентном коде без синхронизации.
>     

---

> [!tip]  
> **Практики:**
> 
> - Выбирайте `map[K]struct{}`, если важно **минимизировать потребление памяти**.
>     
> - Используйте `map[K]bool`, если нужно хранить **дополнительную информацию** о каждом элементе.
>     
> - Обратите внимание на пакеты из `golang.org/x/exp/maps` и `cmp` для удобной работы с коллекциями.
>     
> - Используйте `[[Set (структура данных)]]` как семантическое представление, `map` — как реализацию.
>     

---

> [!faq]  
> **Q:** Почему `struct{}` экономичнее `bool`?  
> **A:** `struct{}` не занимает памяти — это пустой тип. А `bool` — как минимум один байт.
>
> **Q:** Как сериализовать set в JSON?  
> **A:** Преобразуйте `set` в `[]T` перед сериализацией (например, через `for k := range set`).
>
> **Q:** Как сделать thread-safe set?  
> **A:** Используйте `sync.Mutex + map` или `sync.Map`, если требуется доступ из нескольких горутин.

---

## Полезные ссылки

- [Go Blog — Maps in Action](https://go.dev/blog/maps)
    
- [Go Specification — Map types](https://golang.org/ref/spec#Map_types)
    
- [YourBasic: Set на Go](https://yourbasic.org/golang/implement-set/)
    
- [Go by Example: Maps](https://gobyexample.com/maps)

