## Основная идея

> [!info]  
> **TDD (Test‑Driven Development)** — разработка через [[Тестирование и анализ качества|тестирование]]: сначала пишем тест, затем код, затем улучшаем дизайн, сохраняя зелёные тесты.

---

## Краткий конспект

- **TDD‑цикл** — Red, Green, Refactor.
    
- **Цель** — быстрая обратная связь, уверенность в корректности, чистая архитектура.
    
- **Плюсы**: документирующие тесты, меньше дефектов, гибкий рефакторинг.

---

## Подробно

### Что такое TDD?

Термин популяризовал Кент Бек. Методика предписывает маленькие итерации: сначала падающий тест (Red), затем минимальная реализация (Green) и, наконец, улучшение внутренней структуры (Refactor). Такой ритм обеспечивает постоянное подтверждение корректности кода.

### Цикл Red → Green → Refactor

```go
// math_test.go — Шаг 1 (Red)
func TestAdd(t *testing.T) {
	want := 4
	got := Add(2, 2)
	if got != want {
		t.Fatalf("want %d, got %d", want, got)
	}
}
```

```go
// math.go — Шаг 2 (Green)
func Add(a, b int) int {
	return a + b
}
```

```go
// Шаг 3 (Refactor)
// Пока логики мало, но позже можно вынести
// общие проверки в helper или добавить валидацию.
```

```bash
go test ./...   # все этапы выполняются одной командой
```

---

### Нюансы и подводные камни

> [!warning]
> 
> - **Большие шаги** ломают цикл — держите изменения минимальными.
>     
> - **Тесты‑заглушки** вместо настоящих проверок дают ложное чувство безопасности.
>     
> - **Скорость**: плохо написанные тесты замедляют CI. Оптимизируйте или параллельте их.
>     

### Рекомендации и FAQ

> [!tip]  
> Добавляйте `t.Parallel()` даже внутри таблиц тестов: это ускоряет прогон и помогает ловить гонки.

> [!faq]  
> **Q:** Как генерировать [[Моки|моки]]?  
> **A:** Установите `mockgen`:
> 
> ```bash
> go install go.uber.org/mock/mockgen@latest
> mockgen -source=iface.go -destination=iface_mock.go
> ```
> 
> **Q:** Нужно ли писать тесты на приватные функции?  
> **A:** Проверяйте поведение через публичный API; приватные детали должны покрываться косвенно.  
> **Q:** Можно ли комбинировать TDD и BDD?  
> **A:** Да: опишите сценарии на уровне поведения (BDD), а реализацию ведите TDD‑циклом.

---

## Полезные ссылки

- [https://golang.org/doc/testing](https://golang.org/doc/testing)
    
- [https://go.dev/doc/testing](https://go.dev/doc/testing)