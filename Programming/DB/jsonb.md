> [!info] **–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è**  
> `jsonb` ‚Äî —ç—Ç–æ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è JSON –≤ PostgreSQL, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ. –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ `jsonb`, ‚Äî —ç—Ç–æ **GIN**, –æ—Å–æ–±–µ–Ω–Ω–æ —Å `jsonb_path_ops` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–∞–º.

---

## –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç

- `jsonb` ‚Äî —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è JSON, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏.
- –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `json`, `jsonb` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∏–Ω–∞—Ä–Ω–æ–º –≤–∏–¥–µ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –∫–ª—é—á–µ–π.
- GIN-–∏–Ω–¥–µ–∫—Å—ã –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø–æ–ª—è–º `jsonb`.
- GiST-–∏–Ω–¥–µ–∫—Å—ã –¥–∞—é—Ç –±–æ–ª—å—à–µ –≥–∏–±–∫–æ—Å—Ç–∏, –Ω–æ —É—Å—Ç—É–ø–∞—é—Ç –≤ —Å–∫–æ—Ä–æ—Å—Ç–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤—É —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–µ–π—Å–æ–≤.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `jsonb` –æ–ø—Ä–∞–≤–¥–∞–Ω–æ –ø—Ä–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö, –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –ª–æ–≥–∞—Ö.

---

## –ü–æ–¥—Ä–æ–±–Ω–æ

### –ß—Ç–æ —Ç–∞–∫–æ–µ `json` vs `jsonb`

PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è JSON:

| –¢–∏–ø     | –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è | –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è | –ë—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|---------|------------------|------------|----------------|-------------|
| `json`  | –¢–µ–∫—Å—Ç             | –ù–µ—Ç        | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ      | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∏ –ø—Ä–æ–±–µ–ª—ã |
| `jsonb` | –ë–∏–Ω–∞—Ä–Ω—ã–π          | –î–∞ (GIN, GiST) | –ë—ã—Å—Ç—Ä–µ–µ      | –£–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã, —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–ª—é—á–∏ |

> [!tip]
> –í—Å–µ–≥–¥–∞ –≤—ã–±–∏—Ä–∞–π—Ç–µ `jsonb`, –µ—Å–ª–∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –ø–æ JSON-–¥–∞–Ω–Ω—ã–º.

---

### –ü–æ—á–µ–º—É –∏ –∫–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å `jsonb`

`jsonb` –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö:

- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞).
- –ù—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
- –í–∞–∂–Ω–æ –±—ã—Å—Ç—Ä–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –∫–ª—é—á–∞–º –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º.
- –ù—É–∂–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ JSON (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ —Ñ–ª–∞–≥–∞–º –∏–ª–∏ —Å—Ç–∞—Ç—É—Å–∞–º).

–¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –ª–æ–≥–∏, –∞—É–¥–∏—Ç—ã, —Å–æ–±—ã—Ç–∏—è, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.

---

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç GIN- –∏ GiST-–∏–Ω–¥–µ–∫—Å—ã –¥–ª—è `jsonb`

#### GIN-–∏–Ω–¥–µ–∫—Å—ã

```sql
CREATE INDEX idx_data_gin ON events USING gin (data);
```

- –†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏ —Å `@>`, `?`, `?|`, `?&` –∏ —Ç.–ø.
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `jsonb_ops` ‚Äî –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤—Å—ë: –∫–ª—é—á–∏, –∑–Ω–∞—á–µ–Ω–∏—è, –º–∞—Å—Å–∏–≤—ã.
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `jsonb_path_ops` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

```sql
CREATE INDEX idx_data_gin_path ON events USING gin (data jsonb_path_ops);
```

> [!example]
> ```sql
> SELECT * FROM events WHERE data @> '{"status": "active"}';
> EXPLAIN ANALYZE ...
> ```
> –¢–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å —Ö–æ—Ä–æ—à–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è GIN-–∏–Ω–¥–µ–∫—Å–æ–º, –æ—Å–æ–±–µ–Ω–Ω–æ —Å `jsonb_path_ops`.

#### GiST-–∏–Ω–¥–µ–∫—Å—ã

```sql
CREATE INDEX idx_data_gist ON events USING gist (data);
```

- –ë–æ–ª–µ–µ –≥–∏–±–∫–∏–π, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, range + jsonb).

> [!tip]
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GIN –≤ 90% —Å–ª—É—á–∞–µ–≤. GiST ‚Äî –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å `jsonb` —Å –¥—Ä—É–≥–∏–º–∏ —Ç–∏–ø–∞–º–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã.

---

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

- –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GIN —Å `jsonb_path_ops`.
- –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ **–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å** –¥–∞–Ω–Ω—ã—Ö: –µ—Å–ª–∏ –ø–æ–ª—è —Å–ª–∏—à–∫–æ–º —Ä–∞–∑–Ω—ã–µ ‚Äî –∏–Ω–¥–µ–∫—Å –º–∞–ª–æ –ø–æ–º–æ–∂–µ—Ç.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `EXPLAIN ANALYZE` –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

```sql
EXPLAIN ANALYZE
SELECT * FROM events WHERE data @> '{"type": "click"}';
```

- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `jsonb`-–ø–æ–ª–µ–π –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Ä–æ–≥–∏–º ‚Äî –∏–∑–±–µ–≥–∞–π—Ç–µ —á–∞—Å—Ç—ã—Ö `UPDATE`.
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ `jsonb` –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã —Å —Ç–∏–ø–∞–º–∏.

> [!tip]
> GIN-–∏–Ω–¥–µ–∫—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏, –Ω–æ —Ä–µ–∑–∫–æ —É—Å–∫–æ—Ä—è—é—Ç `SELECT`.

---

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

#### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—è–º

```sql
SELECT * FROM orders WHERE metadata @> '{"channel": "email"}';
```

#### –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤ JSONB

```sql
SELECT * FROM docs WHERE to_tsvector('english', data::text) @@ to_tsquery('postgres');
```

> [!example]
> –ó–¥–µ—Å—å `data` ‚Äî —ç—Ç–æ `jsonb`, –∏ –º—ã –∏—â–µ–º –ø–æ –µ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é. –ú–æ–∂–Ω–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ GIN + `to_tsvector`.

#### –ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ JSON

```sql
SELECT data->>'source' AS source, COUNT(*)
FROM logs
GROUP BY data->>'source';
```

---

## –ù—é–∞–Ω—Å—ã –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

> [!warning]
> - üîÅ **–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏.** `jsonb` ‚Äî –Ω–µ –∑–∞–º–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º.  
> - üê¢ **–ò–Ω–¥–µ–∫—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å `data->>'key' = 'value'`**, –µ—Å–ª–∏ –Ω–µ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ `@>` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã.  
> - üìâ **–ë–æ–ª—å—à–æ–π GIN-–∏–Ω–¥–µ–∫—Å –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –≤—Å—Ç–∞–≤–∫—É** ‚Äî —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º SELECT/INSERT.  
> - üß† **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `jsonb`-–ø–æ–ª—é –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞**, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –±–∏–Ω–∞—Ä–Ω—ã–π —Ç–∏–ø –±–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞.

---

> [!faq]
>
**Q:** –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è `jsonb` –æ—Ç `json` –≤ –ø–ª–∞–Ω–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è?  
**A:** `jsonb` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–∏–Ω–∞—Ä–Ω–æ–º –≤–∏–¥–µ, –±—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è.
>
**Q:** –ö–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è `jsonb`?  
**A:** –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ ‚Äî GIN, –æ—Å–æ–±–µ–Ω–Ω–æ —Å `jsonb_path_ops`.
>
**Q:** –ü–æ—á–µ–º—É `data->>'field' = 'value'` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å?  
**A:** –ü–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@>` –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å.
>
**Q:** –ú–æ–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å `jsonb`-–æ–±—ä–µ–∫—Ç–∞?  
**A:** –ù–µ—Ç ‚Äî `jsonb` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—è.
>
**Q:** –ö–æ–≥–¥–∞ –ª—É—á—à–µ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç `jsonb` –≤ –ø–æ–ª—å–∑—É –æ–±—ã—á–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫?  
**A:** –ö–æ–≥–¥–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑–≤–µ—Å—Ç–Ω–∞ –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ ‚Äî –æ–±—ã—á–Ω—ã–µ —Ç–∏–ø—ã –±—ã—Å—Ç—Ä–µ–µ –∏ –ø—Ä–æ—â–µ.

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- https://www.postgresql.org/docs/current/datatype-json.html
- https://www.postgresql.org/docs/current/gin.html
- https://pganalyze.com/blog/gin-index
- https://www.dbvis.com/thetable/everything-you-need-to-know-about-the-postgres-jsonb-data-type/
