> [!info] Основная идея
> В этом кратком обзоре — «дефолтный набор» для нового Go-сервиса:  
> **логирование** (zap), **статический анализ** (golangci-lint + Staticcheck) и **распределённая трассировка** (OpenTelemetry-Go).  
> Jaeger-клиент для Go официально **депрекейтнут**, рекомендован переход на OpenTelemetry SDK и OTLP. :contentReference[oaicite:0]{index=0}

---
# Наблюдаемость: схема

> Вот схема, которая показывает, как устроена система наблюдаемости:
> 
> - **Приложение (Go)**
>     
>     - Экспонирует **метрики** через `/metrics`, которые собирает **Prometheus**.
>         
>     - Пишет **структурированные логи** (zap), которые идут в **Loki**.
>         
>     - Отправляет **трейсы** через **OpenTelemetry SDK** в **Jaeger**.
>         
> - **Хранилища**
>     
>     - Prometheus хранит **метрики** (time series).
>         
>     - Loki хранит **логи**.
>         
>     - Jaeger хранит **трейсы**.
>         
> - **Grafana**
>     
>     - Подключается ко всем системам (Prometheus, Loki/ELK, Jaeger/Tempo).
>         
>     - Показывает **метрики, логи и трейсы в одном интерфейсе**, с возможностью перехода от метрики → в трейсы → в логи по `trace_id`.
>

___
## Что мы будем смотреть

| Задача   | Библиотека            | Почему именно она |
|---|---|---|
| Логи | **`zap`** | Один из самых быстрых структурных логгеров с минимальными аллокациями и готовыми пресетами. В независимых обзорах zap и zerolog стабильно лидируют. :contentReference[oaicite:1]{index=1} |
| Линтер | **`golangci-lint`** | Один бинарник, десятки линтеров, простая интеграция в CI и единый конфиг. :contentReference[oaicite:2]{index=2} |
| | **`Staticcheck`** | Глубокий анализ, ловит реальные дефекты; удобно включается через golangci-lint. :contentReference[oaicite:3]{index=3} |
| Трейсинг | **OpenTelemetry-Go** | CNCF-стандарт: трэйсы/метрики/логи, OTLP-экспорт (в т.ч. в Jaeger ≥ 1.35). :contentReference[oaicite:4]{index=4} |
| | **Jaeger (client-go)** | Клиент в режиме maintenance/deprecated — мигрируйте на OTEL. :contentReference[oaicite:5]{index=5} |

---

## 1. Логирование

> [!example] `uber-go/zap` — быстрый структурный логгер
> ```go
> logger, _ := zap.NewProduction() // или zap.NewDevelopment()
> defer func() { _ = logger.Sync() }() // важен для буферизации/флашей
> 
> logger.Info("connected",
>   zap.String("db", "postgres"),
>   zap.Int("retries", 1),
> )
> // "сахарный" API:
> sug := logger.Sugar()
> sug.Infof("user %s logged in", userID)
> ```
> **Когда выбирать:** высоконагруженные сервисы, где объём логов велик и важны аллокации и скорость. :contentReference[oaicite:6]{index=6}

> [!tip]
> Если логов очень много, пишите в stdout и позвольте агенту (Vector/Fluent Bit/Collector) заниматься доставкой и ротацией.

---

## 2. Линтеры

> [!example] Быстрый старт с `golangci-lint`
> 1) Установка  
> ```bash
> go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
> ```
> 2) Минимальный `.golangci.yml`
> ```yaml
> run:
>   timeout: 3m
> linters:
>   enable:
>     - govet         # базовые проверки компилятора
>     - staticcheck   # глубокие дефекты
>     - revive        # стиль и best practices
> ```
> 3) Запуск: `golangci-lint run ./...` (в CI — тем же образом). :contentReference[oaicite:7]{index=7}

> [!tip]
> Большой монорепо? Добавьте `--concurrency 4`, чтобы ограничить одновременность и память.

> [!note]
> `Staticcheck` можно держать включённым через golangci-lint — отдельной установки не нужно. :contentReference[oaicite:8]{index=8}

---

## 3. Распределённая трассировка

> [!example] OpenTelemetry-Go: минимальная инициализация трассера (HTTP OTLP)
> ```go
> // go.opentelemetry.io/otel v1.x
> ctx := context.Background()
> exp, _ := otlptracehttp.New(ctx) // по умолчанию http://localhost:4318/v1/traces
> 
> tp := sdktrace.NewTracerProvider(
>   sdktrace.WithBatcher(exp), // батчер вместо ручного процессора
> )
> defer func() { _ = tp.Shutdown(ctx) }()
> otel.SetTracerProvider(tp)
> 
> tr := otel.Tracer("svc")
> ctx, span := tr.Start(ctx, "work")
> span.End()
> ```
> OTLP-экспорт поддерживается большинством бэкендов и Collector’ом; Jaeger ≥ 1.35 умеет принимать OTLP напрямую. :contentReference[oaicite:9]{index=9}

> [!tip]
> Для «видимости из коробки» подключите OTEL Collector (Docker) и включите приём OTLP → экспорт в Jaeger/Tempo/отчёты. :contentReference[oaicite:10]{index=10}

> [!warning]
> Официальный `jaeger-client-go` **deprecated** — новых фич не будет. Используйте OpenTelemetry SDK и экспортируйте в Jaeger по OTLP. :contentReference[oaicite:11]{index=11}

---

## FAQ

> [!faq]
> **В чём разница между zap и zerolog по производительности?**  
> Оба крайне быстры; в независимых сравнениях zerolog часто первый, zap — рядом. Выбирайте по экосистеме и удобству API. :contentReference[oaicite:12]{index=12}
>
> **Нужно ли держать и golangci-lint, и Staticcheck?**  
> Обычно достаточно включить `staticcheck` внутри golangci-lint — вы получите правила Staticcheck плюс остальные проверки. :contentReference[oaicite:13]{index=13}
>
> **Как отправлять трэйсы в Jaeger «без костылей»?**  
> Используйте OTLP-экспорт из OpenTelemetry-Go; Jaeger/Collector принимает OTLP, клиенты Jaeger — в maintenance. :contentReference[oaicite:14]{index=14}

---

## Итоги

> [!summary]
> • **Новый проект:** `zap` + `golangci-lint` (со `staticcheck`) + OpenTelemetry-Go (OTLP).  
> • **Про скорость:** `zap`/`zerolog` — лучшие кандидаты среди популярных структурных логгеров. :contentReference[oaicite:15]{index=15}  
> • **Легаси Jaeger:** добавляйте OpenTelemetry SDK и отправляйте OTLP в Jaeger/Collector; планируйте миграцию с jaeger-client-go. :contentReference[oaicite:16]{index=16}
