> [!info]  
> **Основная идея** — мультистейдж сборка в Docker позволяет разделять этапы сборки и финального образа, убирая ненужные зависимости и инструменты из продакшн-контейнера. На собеседованиях это спрашивают, чтобы проверить навыки оптимизации и знания Docker best practices.

## Краткий конспект

- Мультистейдж (multi-stage) — это несколько `FROM` в одном `Dockerfile`, каждый из которых выполняет свою задачу.
- Финальный образ содержит только нужные артефакты, без сборочных инструментов.
- Главное преимущество — **уменьшение размера образа** и повышение **безопасности**.
- Позволяет **сильно кешировать** стадии (особенно при использовании BuildKit).
- Минусы: сложнее отлаживать, может незначительно увеличивать общее время сборки.
- Требует понимания структуры проекта и точных путей при `COPY --from`.

### Пример простого `Dockerfile`

```dockerfile
FROM golang:1.22 AS builder
WORKDIR /app
COPY . .
RUN go build -o server

FROM alpine:3.19
COPY --from=builder /app/server /server
CMD ["/server"]
```

> [!tip] Как отвечать на собеседовании  
> - Сформулируй кратко: «multi-stage — способ собрать и упаковать приложение в одном Dockerfile, отделяя build от runtime».  
> - Подчеркни выгоду: меньший размер, безопасность, отсутствие dev-зависимостей.  
> - Упомяни, что можно использовать `--target` для отладки стадий.  
> - Если спросят о кросс-компиляции или BuildKit — скажи, что multi-stage хорошо сочетается с `--platform` и сборкой на CI.
